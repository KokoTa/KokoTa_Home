<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS精度问题 | KokoTa&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/KokoTa_Home/assets/css/0.styles.42391945.css" as="style"><link rel="preload" href="/KokoTa_Home/assets/js/app.5aa2fc63.js" as="script"><link rel="preload" href="/KokoTa_Home/assets/js/2.f316d9e6.js" as="script"><link rel="preload" href="/KokoTa_Home/assets/js/13.96a14a48.js" as="script"><link rel="prefetch" href="/KokoTa_Home/assets/js/10.a9408bab.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/11.afe9acb0.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/12.20b684e8.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/14.7fbab43c.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/15.c94cf8e5.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/16.636c15bf.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/17.61b345d1.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/18.6438c8af.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/19.a7367e7f.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/20.afbf2002.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/21.189a1078.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/22.024a4a11.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/23.781c0901.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/24.25347c92.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/25.713bc585.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/26.84be1e5d.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/27.a914d101.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/28.cc74e010.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/29.8c624b89.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/3.137d0a24.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/30.db83752a.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/31.8a4e8fdb.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/32.27e1eac7.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/33.49f44af8.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/34.242d9c41.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/35.2da8abc4.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/36.8e90cb74.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/37.ddbb7313.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/38.46018d6a.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/39.126f7b49.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/4.a018097d.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/40.52371e0b.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/41.dc35554b.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/42.90cf799c.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/43.417fb137.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/44.b5b86393.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/45.62db7fc8.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/46.33329211.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/47.5dd730b0.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/48.8bf9775b.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/49.4aa4884e.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/5.f4fd9258.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/6.768d9e6b.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/7.37408dde.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/8.34002bbc.js"><link rel="prefetch" href="/KokoTa_Home/assets/js/9.e96cfb2c.js">
    <link rel="stylesheet" href="/KokoTa_Home/assets/css/0.styles.42391945.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/KokoTa_Home/" class="home-link router-link-active"><!----> <span class="site-name">KokoTa's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/KokoTa_Home/front/" class="sidebar-heading clickable router-link-active open"><span>旧文章迁移</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/KokoTa_Home/front/盒模型与BFC与布局.html" class="sidebar-link">盒模型与BFC与布局</a></li><li><a href="/KokoTa_Home/front/事件与类型.html" class="sidebar-link">事件与类型</a></li><li><a href="/KokoTa_Home/front/HTTP.html" class="sidebar-link">HTTP</a></li><li><a href="/KokoTa_Home/front/原型.html" class="sidebar-link">原型</a></li><li><a href="/KokoTa_Home/front/类与继承.html" class="sidebar-link">类与继承</a></li><li><a href="/KokoTa_Home/front/通信与安全.html" class="sidebar-link">通信与安全</a></li><li><a href="/KokoTa_Home/front/渲染与运行与性能与监控.html" class="sidebar-link">渲染与运行与性能与监控</a></li><li><a href="/KokoTa_Home/front/HTTPS.html" class="sidebar-link">HTTPS</a></li><li><a href="/KokoTa_Home/front/Cookie与Session与Token.html" class="sidebar-link">Cookie与Session与Token</a></li><li><a href="/KokoTa_Home/front/跨域.html" class="sidebar-link">跨域</a></li><li><a href="/KokoTa_Home/front/移动端适配.html" class="sidebar-link">移动端适配</a></li><li><a href="/KokoTa_Home/front/JS精度问题.html" class="active sidebar-link">JS精度问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/KokoTa_Home/front/JS精度问题.html#浮点数的存储" class="sidebar-link">浮点数的存储</a></li><li class="sidebar-sub-header"><a href="/KokoTa_Home/front/JS精度问题.html#浮点数表示方法" class="sidebar-link">浮点数表示方法</a></li><li class="sidebar-sub-header"><a href="/KokoTa_Home/front/JS精度问题.html#解决方法" class="sidebar-link">解决方法</a></li><li class="sidebar-sub-header"><a href="/KokoTa_Home/front/JS精度问题.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/KokoTa_Home/front/服务端踩坑日记.html" class="sidebar-link">服务端踩坑日记</a></li><li><a href="/KokoTa_Home/front/前端问题汇总.html" class="sidebar-link">前端问题汇总</a></li><li><a href="/KokoTa_Home/front/微信开发.html" class="sidebar-link">微信开发</a></li><li><a href="/KokoTa_Home/front/JS的this.html" class="sidebar-link">JS的this</a></li><li><a href="/KokoTa_Home/front/缓存.html" class="sidebar-link">缓存</a></li><li><a href="/KokoTa_Home/front/MVVM.html" class="sidebar-link">MVVM</a></li><li><a href="/KokoTa_Home/front/混合开发.html" class="sidebar-link">混合开发</a></li><li><a href="/KokoTa_Home/front/直播.html" class="sidebar-link">直播</a></li><li><a href="/KokoTa_Home/front/内网穿透.html" class="sidebar-link">内网穿透</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KokoTa_Home/question/" class="sidebar-heading clickable"><span>前端知识汇总</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js精度问题"><a href="#js精度问题" class="header-anchor">#</a> JS精度问题</h1> <p>本来用着JS写代码是一件很舒服的事情，但是自从接手了价格计算的功能后，一点都开森不起来，理由如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加法 =====================</span>
<span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.30000000000000004</span>
<span class="token number">0.7</span> <span class="token operator">+</span> <span class="token number">0.1</span> <span class="token operator">=</span> <span class="token number">0.7999999999999999</span>
<span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.4</span> <span class="token operator">=</span> <span class="token number">0.6000000000000001</span>

<span class="token comment">// 减法 =====================</span>
<span class="token number">1.5</span> <span class="token operator">-</span> <span class="token number">1.2</span> <span class="token operator">=</span> <span class="token number">0.30000000000000004</span>
<span class="token number">0.3</span> <span class="token operator">-</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.09999999999999998</span>
 
<span class="token comment">// 乘法 =====================</span>
<span class="token number">19.9</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">1989.9999999999998</span>
<span class="token number">0.8</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2.4000000000000004</span>
<span class="token number">35.41</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">3540.9999999999995</span>

<span class="token comment">// 除法 =====================</span>
<span class="token number">0.3</span> <span class="token operator">/</span> <span class="token number">0.1</span> <span class="token operator">=</span> <span class="token number">2.9999999999999996</span>
<span class="token number">0.69</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">=</span> <span class="token number">0.06899999999999999</span>
</code></pre></div><p>是的，你没有看错，Javascript存在精度问题，由于当时项目急于上线，因此把价格计算托付给了后端大佬们去实现，省了不少麻烦。<br>
不过现在回过头来看看，原理是肿么回事？前端是否可以解决这个问题呢？</p> <h2 id="浮点数的存储"><a href="#浮点数的存储" class="header-anchor">#</a> 浮点数的存储</h2> <p>JS 浮点数使用 64 位固定长度比特来表示，即标准的双精度(double)。<br>
这种存储结构的优点是归一化处理整数和小数，节省存储空间。</p> <p>这 64 位比特分为三个部分：</p> <ul><li>符号位S：即第 1 位，表示正负，0为正，1为负</li> <li>指数位E：即第 2 位 ~ 第 12 位，表示次方数</li> <li>尾数位M：即后面剩余的 52 位，表示尾数，超出的部分自动 <code>进 1 舍 0</code></li></ul> <p>接下来我们回顾一下二进制及编码的知识，这有助于接下来的理解：</p> <ol><li>原码：计算机中对数字的二进制表示，最高位表示符号，其余表示数值。优点是简单直观，缺点是不能直接计算。因为如果是正数，原码是可以正常表示并参与计算的，但如果是负数，那么原码需要转成反码后才能进行计算。<strong>eg</strong>：假设有两个四位二进制数，<code>0001</code> 表示 1，<code>1001</code> 表示 -1，此时若两者相加 <code>0001 + 1001 = 1010 = -2 != 0</code>，结果为 -2 是错误的。</li> <li>反码：反码即除了符号位外，反转了剩余所有原码的位。<code>1001</code> 的反码是 <code>1110</code>，此时 <code>0001 + 1110 = 1111</code>，而 <code>1111</code> 表示 -0 (<code>0000</code> 表示 +0)，所以结果是正确的。所以说反码解决了负数的二进制表示问题。</li> <li>补码：从上一点我们知道了 0 有两个，即 +0 和 -0，按常识来说我们希望只有一个 0，此时我们给负数的所有反码 +1，如图：<br> <img src="/images/%E5%8E%9F%E7%A0%81%E5%8F%8D%E7%A0%81%E8%A1%A5%E7%A0%81.png" alt="image">
这样我们就解决了 0 的问题，同时也解决了&quot;正负数相加不等于0&quot;的问题</li></ol> <h2 id="浮点数表示方法"><a href="#浮点数表示方法" class="header-anchor">#</a> 浮点数表示方法</h2> <p>从 IEEE 754 规范中我们可以得到二进制浮点数的公式：<br> <img src="/images/%E6%B5%AE%E7%82%B9%E6%95%B0%E5%85%AC%E5%BC%8F.jpg" alt="image"><br>
公式以科学记数法的形式来表示，其中字母的含义和上一节相对应。</p> <ol><li>S 为符号位，<code>S = 0</code> 时，V为正；<code>S = 1</code> 时，V为负</li> <li>E 为指数位</li> <li>M 为有效字数，由于是科学记数法，所以 <code>1 &lt;= M &lt; 2</code></li></ol> <p>同时规范规定了：</p> <ol><li>由于 <code>1 &lt;= M &lt; 2</code>，所以 M 可以写成 1.xxxx 的格式，而计算机保存 M 时，默认第一位总是 1， 所以只保存小数部分，节省了一位有效数字</li> <li>上一节我们知道指数位为 11 位的二进制，即范围是 0 ~ 2047，然而科学记数法中 E 可以为负数，为为了计算机处理数据的方便，所以 E 的真实值必须取一个中间数（偏移值），<code>1023</code>，即 0 ~1023 为负，1024 ~ 2047 为正(单精度下的范围是 0 ~ 255，中间数为 <code>127</code>)。</li></ol> <p>所以为什么 <code>0.1 + 0.2 = 0.30000000000000004</code> ？
让我们来看看 <strong>浮点数加法运算流程</strong>：</p> <p>我们首先让十进制转为二进制，即：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0.1</span> <span class="token operator">=&gt;</span> <span class="token number">0.000110011001100110011001100110011001100110011001100110</span>
<span class="token number">0.2</span> <span class="token operator">=&gt;</span> <span class="token number">0.001100110011001100110011001100110011001100110011001101</span>
</code></pre></div><p>然后根据科学记数法得到(为方便理解，我们使用单精度来表示)：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0.1</span> <span class="token operator">=&gt;</span> <span class="token number">1.10011001100110011001100110011001100110011001100110</span>
    <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111011</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">10011001100110011001100</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span>

    <span class="token comment">// 1. 小数点后移了四位，指数 E 为 -4，由于中间数为 127，所以对应的指数值为 127 - 4 = 123，转为二进制为 1111011，加上符号位 0，得到 01111011</span>
    <span class="token comment">// 2. (1)为整数位，不计入尾数位</span>

<span class="token number">0.2</span> <span class="token operator">=&gt;</span> <span class="token number">1.100110011001100110011001100110011001100110011001101</span>
    <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111100</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">10011001100110011001100</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span>
</code></pre></div><p>接着我们进行对阶(顾名思义就是对齐阶码，使两数的小数点位置对齐，小阶向大阶对齐)：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 因为 0.1 的阶码为 -4，0.2 的阶码为 -3</span>
<span class="token comment">// -4 &lt; -3，小阶向大阶对齐，所以要使前者对齐后者，使两者相等</span>
<span class="token comment">// 意思就是 0.1 这个数的二进制表示得再前移一位，从向右移动 4 位，变为向右移动 3 位</span>
<span class="token comment">// 这将导致 0.1 的科学计数法：</span>
<span class="token comment">// 1. 指数位本来是 -4，现在变为 -3，指数值为 124，转为二进制后得到 01111100，阶码对齐了</span>
<span class="token comment">// 2. 尾数位因为前进一位，所以整体右移，为 (0)11001100110011001100110</span>
<span class="token comment">// 所以：</span>
<span class="token number">0.1</span> <span class="token operator">=&gt;</span> <span class="token number">0.000110011001100110011001100110011001100110011001100110</span>
    <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111100</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token number">11001100110011001100110</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span>
</code></pre></div><p>OK，现在让 0.1 + 0.2，即：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111100</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token number">11001100110011001100110</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span> <span class="token operator">+</span>
<span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111100</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">10011001100110011001100</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span> <span class="token operator">=</span> 
<span class="token comment">// 由于对阶，所以只求尾数位相加</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token number">11001100110011001100110</span> <span class="token operator">+</span> 
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">10011001100110011001100</span> <span class="token operator">=</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token number">01100110011001100110010</span>
<span class="token comment">// 然后就得到了</span>
<span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111100</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token number">01100110011001100110010</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span>
<span class="token comment">// 因为整数位应为 1，而此时的整数位为 10，超了1位，所以尾数位应整体右移一位，相应的指数位也会变化，格式化后最终得到</span>
<span class="token number">0</span><span class="token punctuation">(</span>符号位<span class="token punctuation">)</span> <span class="token number">01111101</span><span class="token punctuation">(</span>指数位<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">00110011001100110011001</span><span class="token punctuation">(</span>尾数位<span class="token punctuation">)</span>
<span class="token comment">// 总结 =&gt; 尾数位整体右移，阶码变大(-4 -&gt; -3)，指数值也变大(123 -&gt; 124)，指数位变大(01111100 -&gt; 01111101)</span>
</code></pre></div><p>最后你会发现，尾数位最后的 0 被挤掉了，而这个就是产生误差的原因<br>
最终这个数转化为十进制就是 <code>0.30000000000000004</code></p> <p>OK，知道了原因，那么我们该如何避免精度问题呢？</p> <h2 id="解决方法"><a href="#解决方法" class="header-anchor">#</a> 解决方法</h2> <p>一开始的时候，我使用的是 <strong>toFixed</strong>，但是这个 API 也是有问题的，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.35</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1.4 正确</span>
<span class="token number">1.335</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 1.33  错误</span>
<span class="token comment">// 错误的原因是 1.335 在处理时实际对应的的是 1.3349999</span>
</code></pre></div><p>因此 toFixed 方法无法运用到生产环境中</p> <p>接着 <strong>toPrecision</strong> 映入眼帘，它用来处理精度，精度是从左至右第一个不为0的数开始。</p> <p>对于 <code>展示型</code> 数据，我们可以使用这个 API，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token number">1.4000000000000001</span><span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1.4</span>  <span class="token comment">// True</span>
</code></pre></div><p>封装成方法的话：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">strip</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> precision <span class="token operator">=</span> <span class="token number">12</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 一般选择 12 为默认精度，算是经验选择</span>
  <span class="token keyword">return</span> <span class="token operator">+</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span>precision<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但对于 <code>加减乘除</code> 的运算，它就不适用了<br>
因为精度问题发生于小数计算，所以解决方法是将小数变为整数进行计算，然后再变回小数，举个栗子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 精确加法
 */</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> num1Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> num2Digits <span class="token operator">=</span> <span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> baseNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num1Digits<span class="token punctuation">,</span> num2Digits<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>num1 <span class="token operator">*</span> baseNum <span class="token operator">+</span> num2 <span class="token operator">*</span> baseNum<span class="token punctuation">)</span> <span class="token operator">/</span> baseNum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，如果遇到科学记数法(精度大于 21)时，需要特别处理</p> <p>虽然可以手动实现这些运算函数，但是在生产环境中，还是使用现有的轮子比较妥当<br> <a href="https://github.com/nefe/number-precision" target="_blank" rel="noopener noreferrer">number-precision<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/josdejong/mathjs" target="_blank" rel="noopener noreferrer">mathjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以解决精度问题</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://github.com/camsong/blog/issues/9" target="_blank" rel="noopener noreferrer">JavaScript 浮点数陷阱及解法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://juejin.im/post/594a31d0a0bb9f006b0b2624" target="_blank" rel="noopener noreferrer">浮点数精度之谜<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://juejin.im/post/5aa1395c6fb9a028df223516" target="_blank" rel="noopener noreferrer">JS中浮点数精度问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/9/2023, 7:46:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/KokoTa_Home/front/移动端适配.html" class="prev">
        移动端适配
      </a></span> <span class="next"><a href="/KokoTa_Home/front/服务端踩坑日记.html">
        服务端踩坑日记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/KokoTa_Home/assets/js/app.5aa2fc63.js" defer></script><script src="/KokoTa_Home/assets/js/2.f316d9e6.js" defer></script><script src="/KokoTa_Home/assets/js/13.96a14a48.js" defer></script>
  </body>
</html>
